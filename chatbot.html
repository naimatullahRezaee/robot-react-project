<!DOCTYPE html>
<html>
  <head>
    <title>Chatbot</title>
    <link rel="stylesheet" href="style.css">
  </head>
  <body>
    <div class="js-container"></div>

    <script src="https://unpkg.com/supersimpledev/react.js"></script>
    <script src="https://unpkg.com/supersimpledev/react-dom.js"></script>
    <script src="https://unpkg.com/supersimpledev/chatbot.js"></script>

    <script src="https://unpkg.com/supersimpledev/babel.js"></script>
    <script type="text/babel">



      function ChatInput({chatMessages, setChatMessage}){
        const [inputText, setInputText] = React.useState('');

        function saveInputData(event){
          setInputText(event.target.value);
              
        }

        function sendMessage(){
          const newChatMessages =  [
                ...chatMessages,
                {
                  id : crypto.randomUUID()  ,
                  message : inputText,
                  sender : 'user'
                }
              ]
         setChatMessage(newChatMessages   )
            const response = Chatbot.getResponse(inputText)
           setChatMessage(
              [
                ...newChatMessages,
                {
                  id : crypto.randomUUID()  ,
                  message : response,
                  sender : 'robot'
                }
              ]
            )
            

            setInputText('')
          
        }
        return (
          <div className="chat-input-container">
            <input 
              placeholder='Send a message to the chatbot'
              size='30'
              onChange={saveInputData}
              value={inputText}
              className="chat-input"
             
             />
            <button className="send-btn" onClick={sendMessage}>Send</button>
          </div>
        )
      }

      function ChatMessage({message , sender}){
         return (
          <div className={
            sender==='user'
             ? 'chat-message-user'
             : 'chat-message-robot'
            
            }>

            {sender === 'robot' && <img src="robot.png" alt="" width="40" />}
           <div className="chat-message-text">
             {message}
            </div>

            {sender === 'user' && <img src="user.png" alt="" width="40" /> }
            
          
          </div>
        )
      }


      function  ChatMessages({chatMessages}){
        const chatMessageRef = React.useRef(null);

        React.useEffect(()=>{
          const containerElm =  chatMessageRef.current
          if(containerElm){
            containerElm.scrollTop = containerElm.scrollHeight
          }
        },[chatMessages])
        return (
          <div className="chat-messages-container" ref={chatMessageRef}>
          {chatMessages.map( (chatmessage)=> {
                 return (
                   <ChatMessage 
                   key={chatmessage.id}
                   message={chatmessage.message}
                   sender = {chatmessage.sender}
                   />
                 )
             } )
       }
       </div>
        )

      }

      function App () {
        const [chatMessages, setChatMessage] = React.useState(
          [
          { 
            id : 1,
            message : 'hello chatbot',
            sender :'user'
          },
          {
            id: 2,
            message : 'Hello! How can I help you?',
            sender : 'robot'
          },
          {
            id: 3,
            message : 'can you get me todays date?',
            sender : 'user'
          },
          {
            id : 4,
            message : 'Todays is July 28',
            sender : 'robot'
          }
        ]
         )
        return (
          <div className="app-container">
         
         <ChatMessages
            chatMessages={chatMessages}
            setChatMessage = {setChatMessage}
         />

          <ChatInput 
           chatMessages = {chatMessages}
           setChatMessage = {setChatMessage}
          />
          </div>
        )
      };

      const container = document.querySelector('.js-container');
      ReactDOM.createRoot(container).render(<App />);
    </script>
  </body>
</html>